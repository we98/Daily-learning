## 第2章 InnoDB存储引擎

### 2.4 关键特性

- 包括插入缓冲，两次写，自适应哈希索引，可以提高**性能**和**可靠性**

#### 2.4.1 插入缓冲

- 插入缓冲维护着Insert Buffer信息，其保存在缓冲池中，和数据页，索引页一样，**都是一个在缓冲池中的页**
- 主要作用是减少非聚集索引更新时的IO操作，达到性能上的优化
  - InnoDB维护数据时使用了聚集索引表，因此，插入新数据时（同时也维护了聚集索引）属于磁盘的顺序写入，但是更新非聚集索引却属于随机IO
  - InnoDB为了优化非聚集索引的写入，首先判断将要写入的索引所在的页是否在缓冲池中，如果在，直接插入（这种情况就不需要插入缓冲区了）；如果不在，就放入插入缓冲区中，返回结果
  - 之后，InnoDB会以一定频率执行插入缓冲区和非聚集索引叶子结点的合并操作，这通常可以将多个插入一次性的合并到索引结点中，减少了IO，增加了性能
  - 虽然叫做插入缓冲区，但也记录着删除和更新
- 插入缓冲的使用需要满足以下两个条件
  - 索引是辅助索引
  - 索引不是唯一的。解释：很显然，如果索引对应的属性要求唯一，那么在插入时，必须先到索引所在的页查看该索引值是否已经存在，这个查看操作已经是随机IO，再进行插入缓冲已经毫无意义
- 插入缓冲存在的问题
  - 应用程序执行大量的插入和更新时，如果这个时候系统宕机，会有大量的插入缓冲没有得到合并，因此，实例在进行恢复时会占用较多的时间
  - 写密集的情况下，插入缓冲会占用较多的缓冲池内存